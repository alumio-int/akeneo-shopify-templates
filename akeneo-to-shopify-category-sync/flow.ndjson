{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"scheduler-entry","identifier":"akeneo-fetch-categories","name":"Akeneo - Fetch Categories","description":"We need to get all categories from Akeneo system to ensure the parent children relation can be sent in the right order. To do so, we use an Incoming **\"Akeneo - Fetch - Categories\"** to get data from Akeneo Server.\n","object":{"parameters":{"job":[{"prototype":"run-incoming","parameters":{"incoming":"akeneo-fetch-categories"}}],"handlers":[],"priority":2,"expression":"*/2 * * * *"}},"owner":null,"disabled":true}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"incoming-configuration","identifier":"akeneo-fetch-categories","name":"Akeneo - Fetch - Categories","description":"We need to get all categories from Akeneo system to ensure the parent children relation can be sent in the right order. To do so, we use an Incoming **\"Akeneo - Fetch - Categories\"** to get data from Akeneo Server.\n\nThis incoming will create a task inside Alumio with data structured as Alumio base categories.","object":{"parameters":{"subscriber":{"prototype":"http-subscriber","parameters":{"client":"akeneo-client","request":{"uri":"/api/rest/v1/categories","payload":[],"plugins":[],"payloadType":"data","authentications":[]},"pagination":{"prototype":"next","parameters":{"pattern":"_links.next"}},"deserializer":{"prototype":"json","parameters":{"pattern":"_embedded.items","readMethod":"wholeFile"}}}},"transformers":["akeneo-prepare-convert-category-labels-to-localizations","akeneo-convert-category-to-alumio-base","akeneo-filter-category"]}},"owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"http-client","identifier":"akeneo-client","name":"Akeneo - Client","description":"","object":{"prototype":"akeneo-http-client-v2","parameters":{"key":"", "baseUri":"${AKENEO_BASE_URL}","clientId":"${AKENEO_CLIENT_ID}","password":"${AKENEO_PASSWORD}","username":"${AKENEO_USERNAME}","clientSecret":"${AKENEO_CLIENT_SECRET}"}},"owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"akeneo-prepare-convert-category-labels-to-localizations","name":"Akeneo - Prepare convert category - Labels - To localizations","description":"This is the transformer to convert labels data from Akeneo.\n","object":{"meta":[],"prototype":"data","parameters":{"filters":[],"transformers":[{"meta":[],"prototype":"accessor-move","parameters":{"source":{"prototype":"key","parameters":{"keys":[],"root":"labels"}},"destination":{"prototype":"structure","parameters":{"key":"localeCode","keys":[],"root":"localizations","value":"translation"}},"stripEnclosures":true}},{"meta":[],"prototype":"value-remover","parameters":{"patterns":[{"key":"labels"}]}}]}},"owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"akeneo-convert-category-to-alumio-base","name":"Akeneo - Convert - Category - To Alumio Base","description":"This is the transformer to convert the whole category data into Alumio Base data.","object":{"meta":[],"prototype":"chain","parameters":{"transformers":[{"meta":[],"prototype":"data","parameters":{"filters":[],"transformers":[{"meta":[],"prototype":"value-remover","parameters":{"patterns":[{"key":"_links"},{"key":"updated"}]}}]}}]}},"owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"akeneo-filter-category","name":"Akeneo - Filter - Category","description":"We use this transformer to filter previously created into task categories to avoid duplication.","object":{"meta":[],"prototype":"chain","parameters":{"transformers":[{"meta":[],"prototype":"type-setter","parameters":{"entityType":"base-category"}},{"meta":[],"prototype":"storage-filter-stored-entity","parameters":{"storage":"akeneo-filter-categories","addEntityToStorage":true}}]}},"owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"storage","identifier":"akeneo-filter-categories","name":"Akeneo - Filter - Categories","description":"","object":{"parameters":{"path":"akeneo-filter-categories-01JPA48RZG81A0F59D0EVAEJJ4","logger":{"parameters":{"actions":[]}}}},"owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"scheduler-entry","identifier":"shopify-send-collection","name":"Shopify - Send - Collection","description":"The task that was created through Incoming **\"Akeneo - Fetch - Categories\"** will then processed further by the Route **\"Synchronize Categories - From Akeneo into Shopify Collections\"** and will be send using the Outgoing **\"Shopify - Send - Collection\"**.","object":{"parameters":{"job":[{"prototype":"run-outgoing","parameters":{"route":"synchronize-categories-from-akeneo-into-shopify-collections"}}],"handlers":[],"priority":2,"expression":"*/2 * * * *"}},"owner":null,"disabled":true}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"route-configuration","identifier":"synchronize-categories-from-akeneo-into-shopify-collections","name":"Synchronize Categories - From Akeneo into Shopify Collections","description":"The task that was created through Incoming **\"Akeneo - Fetch - Categories\"** will then processed further by the Route **\"Synchronize Categories - From Akeneo into Shopify Collections\"** and will be send using the Outgoing **\"Shopify - Send - Collection\"**.","object":{"parameters":{"incoming":"akeneo-fetch-categories","outgoing":"shopify-send-collection","realtime":false,"transformers":[],"waitingStatus":false,"parallelExecution":[]}},"owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"outgoing-configuration","identifier":"shopify-send-collection","name":"Shopify - Send - Collection","description":"The task that was created through Incoming **\"Akeneo - Fetch - Categories\"** will then processed further by the Route **\"Synchronize Categories - From Akeneo into Shopify Collections\"** and will be send using the Outgoing **\"Shopify - Send - Collection\"**.","object":{"parameters":{"publisher":{"prototype":"no-action-publisher","parameters":[]},"transformers":["shopify-collection-convert-from-alumio-base-category","shopify-collection-send"]}},"owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"shopify-collection-convert-from-alumio-base-category","name":"Shopify - Convert - Collection from Alumio Base Category","description":"This is the transformer to convert Alumio category data inside the task into Shopify collection data.","object":{"meta":[],"prototype":"chain","parameters":{"transformers":[{"meta":[],"prototype":"node","parameters":{"accessor":{"prototype":"key","parameters":{"keys":[],"root":"localizations"}},"nodeFilters":[{"prototype":"value-condition-v2","parameters":{"accessor":{"prototype":"pattern","parameters":{"keys":[],"pattern":"localeCode"}},"conditions":[{"prototype":"one-of","parameters":{"value":["en_US"]}}]}}],"nodeTransformers":[]}},{"meta":[],"prototype":"data","parameters":{"filters":[],"transformers":[{"meta":[],"prototype":"value-mapper","parameters":{"mappers":[{"prototype":"list-values","parameters":[]}],"accessor":{"prototype":"pattern","parameters":{"keys":[],"pattern":"localizations"}}}},{"meta":[],"prototype":"pattern-move","parameters":{"pattern":"code","conditions":[],"replacement":"title"}},{"meta":[],"prototype":"value-setter","parameters":{"configurations":[{"key":"descriptionHtml","value":"&{localizations[0].translation}","mappers":[]}]}},{"meta":[],"prototype":"value-remover","parameters":{"patterns":[{"key":"parent"},{"key":"localizations"}]}}]}}]}},"owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"list-transformer","identifier":"shopify-collection-send","name":"Shopify - Check and send -  Collection","description":"This transformer will check current Shopify collections from previous iteration of this transformer to determine either we need to create or update the category in the Spryker System.","object":{"meta":[],"prototype":"data","parameters":{"filters":[],"transformers":[{"meta":[],"prototype":"value-setter","parameters":{"configurations":[{"key":"id","value":null,"mappers":[]}]}},{"meta":[],"prototype":"storage-get-entity-from-storage","parameters":{"storage":"shopify-collections-title-to-id","storageKey":"&{title}","destination":"id"}},{"meta":[],"prototype":"conditional","parameters":{"filters":[{"prototype":"value-condition-v2","parameters":{"accessor":{"prototype":"pattern","parameters":{"keys":[],"pattern":"id"}},"conditions":[{"prototype":"equals","parameters":{"value":null}}]}}],"elseCases":[],"transformers":[{"meta":[],"prototype":"graphql-transformer","parameters":{"client":"shopify-client","request":{"uri":"/admin/api/2025-01/graphql.json","method":"post","payload":{"query":"mutation createCollectionMetafields($input: CollectionInput!) {\n  collectionCreate(input: $input) {\n    collection {\n      id\n      title\n    }\n    userErrors {\n      message\n      field\n    }\n  }\n}","variables":{"input":{"title":"&{title}","descriptionHtml":"&{descriptionHtml}"}}}}}},{"meta":[],"prototype":"storage-save-entity-in-storage","parameters":{"source":"data.collectionCreate.collection.id","storage":"shopify-collections-title-to-id","storageKey":"&{data.collectionCreate.collection.title}"}}],"elseTransformers":[{"meta":[],"prototype":"graphql-transformer","parameters":{"client":"shopify-client","request":{"uri":"/admin/api/2025-01/graphql.json","method":"post","payload":{"query":"mutation updateCollectionRules($input: CollectionInput!) {\n  collectionUpdate(input: $input) {\n    collection {\n      id\n      title\n      description\n      handle\n    }\n    userErrors {\n      field\n      message\n    }\n  }\n}","variables":{"input":{"id":"&{id}","descriptionHtml":"&{descriptionHtml}"}}}}}}]}}]}},"owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"storage","identifier":"shopify-collections-title-to-id","name":"Shopify - Collections - Title to ID","description":"","object":{"parameters":{"path":"shopify-collections-title-to-id-01JPHP0BXRMADAA0EW4SVZQH64","logger":{"parameters":{"actions":[]}}}},"owner":null,"disabled":false}
{"$schema":"https://di.schema.alumio.com/register.configuration.json","type":"http-client","identifier":"shopify-client","name":"Shopify - Client","description":"","object":{"prototype":"shopify-http-client-v3","parameters":{"token":"${SHOPIFY_PERSONAL_ACCESS_TOKEN}","baseUri":"${SHOPIFY_BASE_URI}"}},"owner":null,"disabled":false}
